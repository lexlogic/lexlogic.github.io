<!doctype html><html lang=en><head><title>Logic | Sec</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keywords content="Newsroom"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Exploring the JWT Attacks Landscape"><meta property="og:description" content="What is JWT ? JWT, or JSON Web Token, is an open standard (RFC 7519) used to exchange security information between a client and a server. Due to its popularity,"><meta property="og:url" content="https://lexlogic.github.io/post/2022-10-03-research-jwt/"><meta property="og:image" content="https://lexlogic.github.io/images/banner.png"><link rel=canonical href=https://lexlogic.github.io/post/2022-10-03-research-jwt/><link rel="shortcut icon" type=image/png href=https://lexlogic.github.io/images/icons/favicon.png><link rel=manifest href=https://lexlogic.github.io/images/icons/site.webmanifest><link rel=stylesheet href=https://lexlogic.github.io/css/styles.02a27b11b708eaf0d4d62ac9947bab7494525b3f61a8686af59ec6e1998f8cb24d2319c527fcdcea12c62736f739bc2e90b185b7af4fa49b48805bc7d557caae.css integrity="sha512-AqJ7EbcI6vDU1irJlHurdJRSWz9hqGhq9Z7G4ZmPjLJNIxnFJ/zc6hLGJzb3ObwukLGFt69PpJtIgFvH1VfKrg=="><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/TweenMax.min.js></script></head><body><div class=nav-drop><div class=nav-body><a href=https://lexlogic.github.io/about/ class=nav_item>About</a>
<a href=https://lexlogic.github.io class=nav_item>Blog</a>
<a href=https://lexlogic.github.io/categories class=nav_item>Category</a>
<a href=https://lexlogic.github.io/tags class=nav_item>Tag</a><div class=nav-close></div><div class=color_mode><label for=mode>Toggle Dark Mode</label>
<input type=checkbox class=color_choice id=mode></div></div></div><header class="nav d-block"><nav class=nav-menu><a href=https://lexlogic.github.io class="nav-brand nav_item"><img src=https://lexlogic.github.io/logo.png class=nav_logo></a><div></div></nav></header><main><div class="wrap mt"><div><p class=post_date>SECURITY | 03. October 2022</p><h1 class=post_title>Exploring the JWT Attacks Landscape</h1><div class=post_body><div class=post_inner><img src=images/banner.png alt=banner.png class=post_thumbnail><h2 id=what-is-jwt->What is JWT ?</h2><p>JWT, or JSON Web Token, is an open standard (RFC 7519) used to exchange security information between a client and a server. Due to its popularity, JWT attacks are one of of the most exploited vulnerability by attackers. Each JWT contains base64 encoded JSON objects. A cryptographic algorithm is used to sign JWT tokens to ensure the token&rsquo;s integrity and protect against JWT attacks.</p><p><br><br></p><h2 id=jwt-structure>JWT structure</h2><p>JSON web tokens consist of three parts separated by dots (.) which are:<br><br></p><ul><li>Header</li><li>Payload</li><li>Signature<br><br>Header consists of two parts; the type of token and the signature being used.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln>1</span><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=err>“alg”:”HS256”,</span> 
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=err>“type”:”JWT”</span> 
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=p>}</span> 
</span></span></code></pre></div><p>The payload contains information about the user and additional entity attributes, called claims. A sample payload would look like:<br><br><code>{ "uid": "1337", "name": "John Doe", "isAdmin": true }</code><br><br>The signature part is created by taking the encoded header, the encoded payload, a secret, and signing them with the algorithm mentioned in the header.</p><p>If HMAC SHA256 algorithm is to be used, the signature will be created in the following way:<br><br></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=ln>1</span><span class=cl>HMACSHA256<span class=o>(</span>base64UrlEncoded<span class=o>(</span>header<span class=o>)</span>+”.”+base64UrlEncoded<span class=o>(</span>payload<span class=o>)</span>, secret<span class=o>)</span>
</span></span></code></pre></div><p>Finally, the JWT token is compiled by joining base64URL encoded header, payload, and the signature with dots. A typical JWT will look like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=ln>1</span><span class=cl>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiIxMzM3IiwibmFtZSI6IkpvaG4gRG9lIiwiaXNBZG1pbiI6InRydWUifQ.sUV1I_A8AuB-D1EVy3_LSlfG2kCysERFKLUX7pej5Eo
</span></span></code></pre></div><p><br><br></p><h2 id=jwt-attacks-in-the-wild>JWT attacks in the wild</h2><ul><li>Change to &lsquo;NONE&rsquo;<br><br>JWT supports &ldquo;none&rdquo; value in alg field for debugging purpose. If this field is set to &ldquo;none&rdquo;, any token will be considered valid, provided signature is empty. This allows attackers to forge the token and set field values according to their requirement.<br><br></li><li>JWT token expiration<br><br>The “exp” payload in JWT is used to check the expiry. If a token doesn’t expire, it is possible that an attacker can masquerade as the victim if they are somehow able to steal the token.<br><br>For this, capture a JWT token and try to use it after the token has expired. If the application still accepts it, this is a security issue.<br><br></li><li>HMAC algorithm<br><br>HMAC and RSA are two most common algorithms used in JWT . HMAC works on the principle of symmetric encryption while RSA used assymetric encryption. To preserve integrity, the secrecy of secret key in HMAC and private key in RSA must be maintained.<br><br>Now, suppose a token was signed with RSA private key and verfied using RSA public key. An attacker might change the alg to HMAC and use the public RSA key to sign the forged token. If the application still verifies it using the public RSA key, we have successfully tampered the token.<br><br></li><li>Brute-forcing JWT token<br><br>It is also possible to brute force the JWT token if a weak secret key is used. Upon successful brute force, we can use the obtained secret to sign the token again using jwt.io with forged input. JWT-cracker can be used to crack the token.<br><br></li></ul><p><code>Usage: jwt-cracker</code><br><br></p><ul><li>Improper signature verification<br><br>Sometimes the developer can ignore signature verification i.e the signature is never verified at the backend. This way, an attacker can provide any random token with forged values to bypass the authentication mechanism.<br><br></li><li>Automate it all<br><br>JWT-tool is a great starter to check for all issues at once just by running few commands. Just run</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=ln>1</span><span class=cl>python3 jwt_tool.py -M at -t <span class=s2>&#34;https://vitcim.com/api/v1/user/id&#34;</span> -rh <span class=s2>&#34;Authorization: Bearer eyJhbG...&lt;JWT Token&gt;&#34;</span>
</span></span></code></pre></div><p>and wait for the results.<br><br></p><ul><li>Directory traversal<br><br>The KID is an optional header in JWT, which allows the developers to specify which key is to be used for verification of the token. This is how the KID parameter looks like in a JWT :</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln>1</span><span class=cl><span class=p>{</span>  
</span></span><span class=line><span class=ln>2</span><span class=cl> <span class=nt>&#34;alg&#34;</span> <span class=p>:</span> <span class=s2>&#34;HS256&#34;</span><span class=p>,</span>  
</span></span><span class=line><span class=ln>3</span><span class=cl> <span class=nt>&#34;typ&#34;</span> <span class=p>:</span> <span class=s2>&#34;JWT&#34;</span><span class=p>,</span>  
</span></span><span class=line><span class=ln>4</span><span class=cl> <span class=nt>&#34;kid&#34;</span> <span class=p>:</span> <span class=s2>&#34;123&#34;</span>        
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The KID provides the location of key file on the file system, improper sanitization before use can lead to directory traversal attacks. When this is the case, the attacker would be able to specify any file in the file system as the key to be used to verify the token. In worst case, the attacker will able to use any key in the file file system for the verification of token.<br><br></p><ul><li>SQL Injection<br><br>Since the KID field can be provided by the user, it paves the way for a number of injection attacks. It can lead to SQL injection if the KID is being fetched from the database. Attacker can use the following payload :<br><br><code>“kid”: "invalid-key' UNION SELECT 'attackers-key';--".</code><br><br>Since the database does not contain invalid-key, the token will now be verified using the <code>attackers-key</code>.<br><br>These are some of the common attacks in JWT authentication. Payatu maintains a series of blogs on different topics related to information security. Visit Payatu blogs to read more.<br><br></li><li>JKU header tampering<br><br>In the JWT header, jku parameter can also be used by developers to specify the JSON Web Key Set URL. This parameter points to an endpoint, where the JSON Web Key (JWK) used to verify the signature is located. Let us understand this by using an example:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=ln> 1</span><span class=cl><span class=o>{</span> 
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=s2>&#34;alg&#34;</span>: <span class=s2>&#34;RS256&#34;</span>, 
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=s2>&#34;typ&#34;</span>: <span class=s2>&#34;JWT&#34;</span>, 
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=s2>&#34;jku&#34;</span>:<span class=s2>&#34;https://key-server.com/key.json&#34;</span> 
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=o>}</span>. 
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=o>{</span> 
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl>  <span class=s2>&#34;user_name&#34;</span>: <span class=s2>&#34;john.doe&#34;</span>, 
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=s2>&#34;is_admin&#34;</span>: <span class=nb>false</span> 
</span></span><span class=line><span class=ln>16</span><span class=cl>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=o>}</span> 
</span></span></code></pre></div><p><br><br>An attacker can replace the jku parameter value with their own JWK instead of the valid one. If there are no proper checks, this gives an attacker permission to sign malicious tokens using their own private key. Once the malicious token is sent, the application will verify it using the attacker’s JWK.</p></div><div class="post_extra mb-2"><div class=copy data-before="Share Story" data-after="Link Copied"><svg class="icon"><use xlink:href="#copy"/></svg></div></div><div></div></div></div><a href=https://lexlogic.github.io class=post_nav><span class=post_next>The Latest<svg class="icon icon_scale"><use xlink:href="#double-arrow"/></svg></span></a></div></main><link rel=stylesheet href=https://lexlogic.github.io/css/styles.cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e.css integrity="sha512-z4PhNX7vuL3xVChQ1m2AB9Yg5AULVxXcg/SpIdNs6c5H0NE8XYXysP+DGNKHfuwvY7kxvUdBeoGlODJ6+SfaPg=="><script src=js/slideshow.js></script>
<script src=https://lexlogic.github.io/js/index.min.d7a417a6642ddd196cd0e08da02121b3257ed5ad37968a79d288bdf0320d6d871eb99a75faee804449e1b7f4d5b8fbb73a7b7a0ae1c31bf012ece86dcf294ac2.js></script><svg width="0" height="0" class="hidden"><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 699.428 699.428" id="copy"><path d="M502.714.0H240.428C194.178.0 153 42.425 153 87.429l-25.267.59c-46.228.0-84.019 41.834-84.019 86.838V612c0 45.004 41.179 87.428 87.429 87.428H459c46.249.0 87.428-42.424 87.428-87.428h21.857c46.25.0 87.429-42.424 87.429-87.428v-349.19L502.714.0zM459 655.715H131.143c-22.95.0-43.714-21.441-43.714-43.715V174.857c0-22.272 18.688-42.993 41.638-42.993l23.933-.721v393.429C153 569.576 194.178 612 240.428 612h262.286c0 22.273-20.765 43.715-43.714 43.715zm153-131.143c0 22.271-20.765 43.713-43.715 43.713H240.428c-22.95.0-43.714-21.441-43.714-43.713V87.429c0-22.272 20.764-43.714 43.714-43.714H459c-.351 50.337.0 87.975.0 87.975.0 45.419 40.872 86.882 87.428 86.882H612v306zm-65.572-349.715c-23.277.0-43.714-42.293-43.714-64.981V44.348L612 174.857h-65.572zm-43.714 131.537H306c-12.065.0-21.857 9.77-21.857 21.835s9.792 21.835 21.857 21.835h196.714c12.065.0 21.857-9.771 21.857-21.835.0-12.065-9.792-21.835-21.857-21.835zm0 109.176H306c-12.065.0-21.857 9.77-21.857 21.834.0 12.066 9.792 21.836 21.857 21.836h196.714c12.065.0 21.857-9.77 21.857-21.836.0-12.064-9.792-21.834-21.857-21.834z"/></symbol><symbol viewBox="0 0 53 42" xmlns="http://www.w3.org/2000/svg" id="double-arrow"><path d="M.595 39.653a1.318 1.318.0 010-1.864L16.55 21.833a1.318 1.318.0 000-1.863L.595 4.014a1.318 1.318.0 010-1.863L2.125.62a1.318 1.318.0 011.864.0l19.35 19.349a1.318 1.318.0 010 1.863l-19.35 19.35a1.318 1.318.0 01-1.863.0zm29 0a1.318 1.318.0 010-1.864L45.55 21.833a1.318 1.318.0 000-1.863L29.595 4.014a1.318 1.318.0 010-1.863l1.53-1.53a1.318 1.318.0 011.864.0l19.35 19.349a1.318 1.318.0 010 1.863l-19.35 19.35a1.318 1.318.0 01-1.863.0z"/></symbol></svg></body></html>